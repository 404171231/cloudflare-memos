import{j as e}from"./radix-vendor-C59FrWl4.js";import{o as s}from"./mobx-vendor-DqSTJMYi.js";import{r as t}from"./leaflet-vendor-lQi0KVke.js";import{k as a,u as r,a as i,N as l,O as o,Q as n,o as c,H as m,c as d,T as x,s as u,t as f,y as j,V as h,L as p,W as y,x as v,h as g,j as N,X as b,E as w,Y as k}from"./index-DbdC5ZdO.js";import{M as E}from"./message-circle-BvpjriJ9.js";import{s as A}from"./utils-vendor-DZvAiLrS.js";import"./mermaid-vendor-Bc-icxuX.js";import"./router-vendor-CwTeFqe9.js";import"./i18n-vendor-U-o9p_NC.js";import"./highlight-vendor-CXi3tuUt.js";import"./katex-vendor-DMFz0ZL2.js";
/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=a("inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]),D=s(({inbox:s})=>{const a=r(),g=i(),[N,b]=t.useState(void 0),[w,k]=t.useState(void 0),[A,D]=t.useState(!1),[I,M]=t.useState(!1);l(async()=>{if(s.activityId)try{const e=await o.getActivity({name:`${n}${s.activityId}`});if(e.payload?.memoComment){const t=e.payload.memoComment,a=await c.getOrFetchMemoByName(t.relatedMemo,{skipStore:!0});b(a);const r=await m.getOrFetchUserByName(s.sender);k(r),D(!0)}}catch(e){return void M(!0)}},[s.activityId]);const R=async(e=!1)=>{await m.updateInbox({name:s.name,status:h.ARCHIVED},["status"]),e||y.success(a("message.archived-successfully"))},S=()=>e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsx(x,{children:e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(v,{className:"w-4 h-auto cursor-pointer text-muted-foreground hover:text-primary",onClick:()=>(async()=>{await m.deleteInbox(s.name),y.success(a("message.deleted-successfully"))})()})}),e.jsx(j,{children:e.jsx("p",{children:a("common.delete")})})]})})})});return e.jsxs("div",{className:"w-full flex flex-row justify-start items-start gap-3",children:[e.jsx("div",{className:d("shrink-0 mt-2 p-2 rounded-full border",s.status===h.UNREAD?"border-primary text-primary bg-primary/10":"border-muted-foreground text-muted-foreground bg-popover"),children:e.jsx(x,{children:e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(E,{className:"w-4 sm:w-5 h-auto"})}),e.jsx(j,{children:e.jsx("p",{children:"Comment"})})]})})}),e.jsx("div",{className:d("border w-full p-2 px-3 rounded-lg flex flex-col justify-start items-start gap-1 border-border hover:bg-background",s.status!==h.UNREAD&&"opacity-60"),children:A?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:s.createTime?.toLocaleString()}),s.status===h.UNREAD?e.jsx(e.Fragment,{children:e.jsx("div",{children:e.jsx(x,{children:e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(C,{className:"w-4 h-auto cursor-pointer text-muted-foreground hover:text-primary",onClick:()=>R()})}),e.jsx(j,{children:e.jsx("p",{children:a("common.archive")})})]})})})}):S()]}),e.jsx("p",{className:"text-base leading-tight cursor-pointer text-muted-foreground hover:underline hover:text-primary",onClick:async()=>{N&&(g(`/${N.name}`),s.status===h.UNREAD&&R(!0))},children:a("inbox.memo-comment",{user:w?.displayName||w?.username,memo:N?.name,interpolation:{escapeValue:!1}})})]}):I?e.jsxs("div",{className:"w-full flex flex-row justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:a("inbox.failed-to-load")}),S()]}):e.jsx("div",{className:"w-full flex flex-row justify-center items-center my-2",children:e.jsx(p,{className:"animate-spin text-muted-foreground"})})})]})}),I=s(()=>{const s=r(),{md:a}=g(),i=A(m.state.inboxes,e=>e.status===h.UNREAD?0:e.status===h.ARCHIVED?1:2);return t.useEffect(()=>{(async()=>{try{await m.fetchInboxes()}catch(e){}})()},[]),e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!a&&e.jsx(N,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-background text-foreground",children:[e.jsx("div",{className:"relative w-full flex flex-row justify-between items-center",children:e.jsxs("p",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",children:[e.jsx(b,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:s("common.inbox")})]})}),e.jsxs("div",{className:"w-full h-auto flex flex-col justify-start items-start px-2 pb-4",children:[0===i.length&&e.jsxs("div",{className:"w-full mt-4 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(w,{}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:s("message.no-data")})]}),e.jsx("div",{className:"flex flex-col justify-start items-start w-full mt-4 gap-4",children:i.map(s=>{if(s.type===k.MEMO_COMMENT)return e.jsx(D,{inbox:s},`${s.name}-${s.status}`)})})]})]})})]})});export{I as default};
