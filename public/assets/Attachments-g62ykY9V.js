import{j as e}from"./radix-vendor-C59FrWl4.js";import{a2 as s}from"./mermaid-vendor-Bc-icxuX.js";import{o as t}from"./mobx-vendor-DqSTJMYi.js";import{r as a}from"./leaflet-vendor-lQi0KVke.js";import{u as r,h as l,b as i,l as m,o as c,j as n,p as o,q as x,I as d,E as f,A as u,r as h,T as j,s as p,t as w,B as y,x as v,y as N}from"./index-DbdC5ZdO.js";import{i as g}from"./utils-vendor-DZvAiLrS.js";import{i as b}from"./i18n-vendor-U-o9p_NC.js";import"./router-vendor-CwTeFqe9.js";import"./highlight-vendor-CXi3tuUt.js";import"./katex-vendor-DMFz0ZL2.js";const k=t(()=>{const t=r(),{md:k}=l(),A=i(),[T,F]=a.useState({searchQuery:""}),[M,Q]=a.useState([]),Y=M.filter(e=>g(e.filename,T.searchQuery)),B=function(e){const t=new Map;return e.sort((e,t)=>s(t.createTime).unix()-s(e.createTime).unix()).forEach(e=>{const a=s(e.createTime).format("YYYY-MM");t.has(a)||t.set(a,[]),t.get(a)?.push(e)}),t}(Y.filter(e=>e.memo)),C=Y.filter(e=>!e.memo);a.useEffect(()=>{m.listAttachments({}).then(({attachments:e})=>{Q(e),A.setFinish(),Promise.all(e.map(e=>e.memo?c.getOrFetchMemoByName(e.memo):null))})},[]);return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!k&&e.jsx(n,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-background text-foreground",children:[e.jsxs("div",{className:"relative w-full flex flex-row justify-between items-center",children:[e.jsxs("p",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",children:[e.jsx(o,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:t("common.attachments")})]}),e.jsx("div",{children:e.jsxs("div",{className:"relative max-w-32",children:[e.jsx(x,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(d,{className:"pl-9",placeholder:t("common.search"),value:T.searchQuery,onChange:e=>F({...T,searchQuery:e.target.value})})]})})]}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-4 mb-6",children:A.isLoading?e.jsx("div",{className:"w-full h-32 flex flex-col justify-center items-center",children:e.jsx("p",{className:"w-full text-center text-base my-6 mt-8",children:t("resource.fetching-data")})}):e.jsx(e.Fragment,{children:0===Y.length?e.jsxs("div",{className:"w-full mt-8 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(f,{}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:t("message.no-data")})]}):e.jsxs("div",{className:"w-full h-auto px-2 flex flex-col justify-start items-start gap-y-8",children:[Array.from(B.entries()).map(([t,a])=>e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsxs("div",{className:"w-16 sm:w-24 pt-4 sm:pl-4 flex flex-col justify-start items-start",children:[e.jsx("span",{className:"text-sm opacity-60",children:s(t).year()}),e.jsx("span",{className:"font-medium text-xl",children:s(t).toDate().toLocaleString(b.language,{month:"short"})})]}),e.jsx("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:a.map(s=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border border-border overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(u,{attachment:s,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-muted-foreground truncate",children:s.filename})})]},s.name))})]},t)),C.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(h,{}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsx("div",{className:"w-16 sm:w-24 sm:pl-4 flex flex-col justify-start items-start"}),e.jsxs("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:t("resource.unused-resources")}),e.jsxs("span",{className:"text-muted-foreground opacity-80",children:["(",C.length,")"]}),e.jsx(j,{children:e.jsxs(p,{children:[e.jsx(w,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"sm",onClick:async()=>{if(window.confirm("Are you sure to delete all unused attachments? This action cannot be undone.")){for(const e of C)await m.deleteAttachment({name:e.name});Q(M.filter(e=>e.memo))}},children:e.jsx(v,{className:"w-4 h-auto opacity-60"})})}),e.jsx(N,{children:e.jsx("p",{children:"Delete all"})})]})})]}),C.map(s=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border border-border overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(u,{attachment:s,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-muted-foreground truncate",children:s.filename})})]},s.name))]})]})]})]})})})]})})]})});export{k as default};
