import{j as e}from"./radix-vendor-C59FrWl4.js";import{o as s}from"./mobx-vendor-DqSTJMYi.js";import{r as a}from"./leaflet-vendor-lQi0KVke.js";import{k as t,a as r,c as l,a3 as o,a4 as m,u as n,a5 as i,a6 as c,a7 as d,a8 as x,a9 as f,aa as h,ab as u,B as p,ac as j,h as w,e as g,o as N,ad as y,n as v,j as b,M as k,ae as C}from"./index-DbdC5ZdO.js";import{F as M}from"./graph-vendor-CtJCme9t.js";import{g as E}from"./utils-vendor-DZvAiLrS.js";import{b as P,a as T,L as B}from"./router-vendor-CwTeFqe9.js";import{M as F}from"./message-circle-BvpjriJ9.js";import"./mermaid-vendor-Bc-icxuX.js";import"./i18n-vendor-U-o9p_NC.js";import"./highlight-vendor-CXi3tuUt.js";import"./katex-vendor-DMFz0ZL2.js";
/**
 * @license lucide-react v0.486.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=t("chart-no-axes-gantt",[["path",{d:"M8 6h10",key:"9lnwnk"}],["path",{d:"M6 12h9",key:"1g9pqf"}],["path",{d:"M11 18h7",key:"c8dzvl"}]]),$=t("circle-arrow-out-up-left",[["path",{d:"M2 8V2h6",key:"hiwtdz"}],["path",{d:"m2 2 10 10",key:"1oh8rs"}],["path",{d:"M12 2A10 10 0 1 1 2 12",key:"rrk4fa"}]]),R=e=>{const s=new Map,a=[];return e.forEach(e=>{const t=e.memo,r=e.relatedMemo;s.has(t.name)||s.set(t.name,{id:t.name,memo:t}),s.has(r.name)||s.set(r.name,{id:r.name,memo:r}),a.push({source:t.name,target:r.name,type:e.type})}),{nodes:Array.from(s.values()),links:a}},S=({className:s,memo:t,parentPage:n})=>{const i=r(),[c]=a.useState("light"),d=a.useRef(null),x=a.useRef(void 0),[f,h]=a.useState({width:0,height:0});a.useEffect(()=>{d.current&&h(d.current.getBoundingClientRect())},[]);return e.jsx("div",{ref:d,className:l("opacity-80",s),children:e.jsx(M,{ref:x,width:f.width,height:f.height,enableZoomInteraction:!0,cooldownTicks:0,nodeColor:e=>e.id===t.name?"#14b8a6":"#a1a1aa",nodeRelSize:3,nodeLabel:e=>o(e.memo.name).slice(0,6).toLowerCase(),linkColor:()=>"light"===c?"#e4e4e7":"#3f3f46",graphData:R(t.relations.filter(e=>e.type===m.REFERENCE)),onNodeClick:e=>{e.memo.name!==t.name&&i(`/${t.name}`,{state:{from:n}})},linkDirectionalArrowLength:3,linkDirectionalArrowRelPos:1,linkCurvature:.25})})},O=({memo:s,className:a,parentPage:t})=>{const r=n(),o=i.fromPartial(s.property||{}),h=o.hasLink||o.hasTaskList||o.hasCode||o.hasIncompleteTasks,u=s.relations.filter(e=>e.type===m.REFERENCE).length>0;return e.jsx("aside",{className:l("relative w-full h-auto max-h-screen overflow-auto hide-scrollbar flex flex-col justify-start items-start",a),children:e.jsxs("div",{className:"flex flex-col justify-start items-start w-full px-1 gap-2 h-auto shrink-0 flex-nowrap hide-scrollbar",children:[u&&e.jsxs("div",{className:"relative w-full h-36 border border-border rounded-lg bg-muted",children:[e.jsx(S,{className:"w-full h-full",memo:s,parentPage:t}),e.jsxs("div",{className:"absolute top-1 left-2 text-xs opacity-60 font-mono gap-1 flex flex-row items-center",children:[e.jsx("span",{children:r("common.relations")}),e.jsx("span",{className:"text-xs opacity-60",children:"(Beta)"})]})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("p",{className:"flex flex-row justify-start items-center w-full gap-1 mb-1 text-sm leading-6 text-muted-foreground select-none",children:e.jsx("span",{children:r("common.created-at")})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.createTime?.toLocaleString()})]}),!E(s.createTime,s.updateTime)&&e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("p",{className:"flex flex-row justify-start items-center w-full gap-1 mb-1 text-sm leading-6 text-muted-foreground select-none",children:e.jsx("span",{children:r("common.last-updated-at")})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.updateTime?.toLocaleString()})]}),h&&e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("p",{className:"flex flex-row justify-start items-center w-full gap-1 mb-1 text-sm leading-6 text-muted-foreground select-none",children:e.jsx("span",{children:r("common.properties")})}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-x-2 gap-y-1 flex-wrap text-muted-foreground",children:[o.hasLink&&e.jsx("div",{className:"w-auto border border-border pl-1 pr-1.5 rounded-md flex justify-between items-center",children:e.jsxs("div",{className:"w-auto flex justify-start items-center mr-1",children:[e.jsx(c,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-sm",children:r("memo.links")})]})}),o.hasTaskList&&e.jsx("div",{className:"w-auto border border-border pl-1 pr-1.5 rounded-md flex justify-between items-center",children:e.jsxs("div",{className:"w-auto flex justify-start items-center mr-1",children:[e.jsx(d,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-sm",children:r("memo.to-do")})]})}),o.hasCode&&e.jsx("div",{className:"w-auto border border-border pl-1 pr-1.5 rounded-md flex justify-between items-center",children:e.jsxs("div",{className:"w-auto flex justify-start items-center mr-1",children:[e.jsx(x,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-sm",children:r("memo.code")})]})})]})]}),s.tags.length>0&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row justify-start items-center w-full gap-1 mb-1 text-sm leading-6 text-muted-foreground select-none",children:[e.jsx("span",{children:r("common.tags")}),e.jsxs("span",{className:"shrink-0",children:["(",s.tags.length,")"]})]}),e.jsx("div",{className:"w-full flex flex-row justify-start items-center relative flex-wrap gap-x-2 gap-y-1",children:s.tags.map(s=>e.jsxs("div",{className:"shrink-0 w-auto max-w-full text-sm rounded-md leading-6 flex flex-row justify-start items-center select-none hover:opacity-80 text-muted-foreground",children:[e.jsx(f,{className:"group-hover:hidden w-4 h-auto shrink-0 opacity-40"}),e.jsx("div",{className:l("inline-flex flex-nowrap ml-0.5 gap-0.5 cursor-pointer max-w-[calc(100%-16px)]"),children:e.jsx("span",{className:"truncate opacity-80",children:s})})]},s))})]})]})})},A=({memo:s,parentPage:t})=>{const r=P(),[l,o]=a.useState(!1);return a.useEffect(()=>{o(!1)},[r.pathname]),e.jsxs(h,{open:l,onOpenChange:o,children:[e.jsx(u,{asChild:!0,children:e.jsx(p,{variant:"ghost",className:"bg-transparent! px-2",children:e.jsx(L,{className:"w-5 h-auto text-muted-foreground"})})}),e.jsx(j,{side:"right",className:"w-full sm:w-80 px-4 bg-popover",children:e.jsx(O,{className:"py-4",memo:s,parentPage:t})})]})},z=s(()=>{const s=n(),{md:t}=w(),o=T(),i=r(),{state:c}=P(),d=g(),x=o.uid,f=`${y}${x}`,h=N.getMemoByName(f),[u,j]=a.useState(void 0),[M,E]=a.useState(!1),L=h?.relations.filter(e=>e.relatedMemo?.name===h.name&&e.type===m.COMMENT)||[],R=L.map(e=>N.getMemoByName(e.memo.name)).filter(e=>e),S=d&&!M;if(a.useEffect(()=>{f?N.getOrFetchMemoByName(f).catch(e=>{v.error(e.details),i("/403")}):i("/404")},[f]),a.useEffect(()=>{h&&(async()=>{h.parent?N.getOrFetchMemoByName(h.parent).then(e=>{j(e)}):j(void 0),await Promise.all(L.map(e=>N.getOrFetchMemoByName(e.memo.name)))})()},[h]),!h)return null;const z=()=>{E(!0)};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!t&&e.jsx(b,{children:e.jsx(A,{memo:h,parentPage:c?.from})}),e.jsxs("div",{className:l("w-full flex flex-row justify-start items-start px-4 sm:px-6 gap-4"),children:[e.jsxs("div",{className:l(t?"w-[calc(100%-15rem)]":"w-full"),children:[u&&e.jsx("div",{className:"w-auto inline-block mb-2",children:e.jsxs(B,{className:"px-3 py-1 border border-border rounded-lg max-w-xs w-auto text-sm flex flex-row justify-start items-center flex-nowrap text-muted-foreground hover:shadow hover:opacity-80",to:`/${u.name}`,state:c,viewTransition:!0,children:[e.jsx($,{className:"w-4 h-auto shrink-0 opacity-60 mr-2"}),e.jsx("span",{className:"truncate",children:u.content})]})}),e.jsx(k,{className:"shadow hover:shadow-md transition-all",memo:h,compact:!1,parentPage:c?.from,showCreator:!0,showVisibility:!0,showPinned:!0,showNsfwContent:!0},`${h.name}-${h.displayTime}`),e.jsxs("div",{className:"pt-8 pb-16 w-full",children:[e.jsx("h2",{id:"comments",className:"sr-only",children:s("memo.comment.self")}),e.jsx("div",{className:"relative mx-auto grow w-full min-h-full flex flex-col justify-start items-start gap-y-1",children:0===R.length?S&&e.jsx("div",{className:"w-full flex flex-row justify-center items-center py-6",children:e.jsxs(p,{variant:"ghost",onClick:z,children:[e.jsx("span",{className:"text-muted-foreground",children:s("memo.comment.write-a-comment")}),e.jsx(F,{className:"ml-2 w-5 h-auto text-muted-foreground"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center h-8 pl-3 mb-2",children:[e.jsxs("div",{className:"flex flex-row justify-start items-center",children:[e.jsx(F,{className:"w-5 h-auto text-muted-foreground mr-1"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("memo.comment.self")}),e.jsxs("span",{className:"text-muted-foreground text-sm ml-1",children:["(",R.length,")"]})]}),S&&e.jsx(p,{variant:"ghost",className:"text-muted-foreground",onClick:z,children:s("memo.comment.write-a-comment")})]}),R.map(s=>e.jsx(k,{memo:s,parentPage:c?.from,showCreator:!0,compact:!0},`${s.name}-${s.displayTime}`))]})}),M&&e.jsx("div",{className:"w-full",children:e.jsx(C,{cacheKey:`${h.name}-${h.updateTime}-comment`,placeholder:s("editor.add-your-comment-here"),parentMemoName:h.name,autoFocus:!0,onConfirm:async e=>{await N.getOrFetchMemoByName(e),await N.getOrFetchMemoByName(h.name,{skipCache:!0}),E(!1)},onCancel:()=>E(!1)})})]})]}),t&&e.jsx("div",{className:"sticky top-0 left-0 shrink-0 -mt-6 w-56 h-full",children:e.jsx(O,{className:"py-6",memo:h,parentPage:c?.from})})]})]})});export{z as default};
